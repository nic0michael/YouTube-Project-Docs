---
title: "Install ZeroTier in Proxmox Using Docker"
date: 2024-06-11T10:14:14Z
draft: false
---

## A. What is ZeroTier
ZeroTier is a software-defined networking solution that enables the creation of secure virtual networks over the internet. ZeroTier allows devices to communicate as if they were on the same local network, regardless of their physical location. It supports various platforms, including Windows, macOS, Linux, iOS, and Android.

## Key features of ZeroTier include:

1. **Ease of Use**: It's designed to be user-friendly, with straightforward setup and configuration.
2. **Cross-Platform Compatibility**: Works across different operating systems and devices.
3. **Scalability**: Can handle small to large networks efficiently.
4. **Security**: Provides encrypted communication to ensure secure data transfer.
5. **Flexibility**: Allows for custom network configurations and virtual LAN setups.


## B. References
https://www.zerotier.com/pricing/
https://github.com/zerotier
https://docs.zerotier.com/
https://www.zerotier.com/download/
https://docs.zerotier.com/docker/
https://github.com/zyclonite/zerotier-docker/blob/main/docker-compose.yml
https://docker-compose.net/ryhtib
https://techoverflow.net/2022/08/19/how-to-setup-zerotier-one-ztncui-using-docker-compose-in-just-2-minutes/

## C.Installation
Here is a step-by-step guide to creating the necessary files, including the `.env` file, `create_network.sh` script, and `docker-compose.yml` file. \
By following these steps, you will set up ZeroTier in your Proxmox container with Docker Compose, using a dynamically generated network ID.

### Step 1: Create the `.env` File

1. **Open the `.env` File with Nano**:

   ```sh
   nano .env
   ```

2. **Add Your ZeroTier API Token**:

   Add your ZeroTier API token to the `.env` file:

   ```sh
   ZEROTIER_API_TOKEN=your_api_token
   ```

   Replace `your_api_token` with your actual ZeroTier API token.

3. **Save and Exit**:
   - Press `CTRL + X` to exit.
   - Press `Y` to confirm changes.
   - Press `Enter` to save the file.

### Step 2: Create the `create_network.sh` Script

1. **Open the `create_network.sh` File with Nano**:

   ```sh
   nano create_network.sh
   ```

2. **Add the Following Script Content**:

   ```sh
   #!/bin/bash

   # Load the API token from the .env file
   source .env

   # Create a new network
   RESPONSE=$(curl -s -X POST -H "Authorization: Bearer $ZEROTIER_API_TOKEN" -H "Content-Type: application/json" -d '{}' "https://my.zerotier.com/api/v1/network")

   # Extract the network ID from the response
   NETWORK_ID=$(echo $RESPONSE | jq -r '.id')

   # Save the network ID to the .env file
   echo "ZEROTIER_NETWORK_ID=$NETWORK_ID" >> .env

   # Print the network ID
   echo "Network ID: $NETWORK_ID"
   ```

3. **Save and Exit**:
   - Press `CTRL + X` to exit.
   - Press `Y` to confirm changes.
   - Press `Enter` to save the file.

4. **Make the Script Executable**:

   ```sh
   chmod +x create_network.sh
   ```

### Step 3: Run the Script to Generate the Network ID

1. **Install `jq`** (if not already installed):

   ```sh
   sudo apt install -y jq
   ```

2. **Run the Script**:

   ```sh
   ./create_network.sh
   ```

   This script will create a new ZeroTier network, save the network ID to the `.env` file, and print the network ID.

### Step 4: Create the `docker-compose.yml` File

1. **Open the `docker-compose.yml` File with Nano**:

   ```sh
   nano docker-compose.yml
   ```

2. **Add the Following Content**:

   ```yaml
   version: '3.8'

   services:
     zerotier-one:
       image: zerotier/zerotier-scratch
       container_name: zerotier-one
       environment:
         - ZEROTIER_NETWORK_ID=${ZEROTIER_NETWORK_ID}
         - ZEROTIER_API_TOKEN=${ZEROTIER_API_TOKEN}
       volumes:
         - zerotier-one-data:/var/lib/zerotier-one
       network_mode: "host"

   volumes:
     zerotier-one-data:

   env_file:
     - .env
   ```

3. **Save and Exit**:
   - Press `CTRL + X` to exit.
   - Press `Y` to confirm changes.
   - Press `Enter` to save the file.

### Step 5: Start the Docker Compose

1. **Run Docker Compose**:

   ```sh
   docker-compose up -d
   ```

This command will start the ZeroTier service in detached mode using the network ID generated by the script and stored in the `.env` file.

### Summary

1. **Create the `.env` File**:
   ```sh
   nano .env
   ```
   Add your ZeroTier API token.

2. **Create the `create_network.sh` Script**:
   ```sh
   nano create_network.sh
   ```
   Add the script content and make it executable:
   ```sh
   chmod +x create_network.sh
   ```

3. **Run the Script**:
   ```sh
   ./create_network.sh
   ```

4. **Create the `docker-compose.yml` File**:
   ```sh
   nano docker-compose.yml
   ```
   Add the Docker Compose content.

5. **Start Docker Compose**:
   ```sh
   docker-compose up -d
   ```


